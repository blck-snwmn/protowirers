# Protowirers 現代化計画

## 概要
このドキュメントは、protowirersプロジェクトを現代的なRustプロジェクトに更新するための調査結果と作業計画をまとめたものです。

## 現在の状況

### Rustバージョン
- 現在のRustバージョン: 1.87.0 (2025-05-09) ✨ 最新版
- メインプロジェクト: Edition 2021
- implサブプロジェクト: Edition 2018 ⚠️ (更新が必要)
- Edition 2024: 利用可能性を確認中

### 依存関係
| ライブラリ | 現在のバージョン | 用途 |
|-----------|----------------|------|
| byteorder | 1 | バイトオーダー処理 |
| syn | 2 (features = ["full"]) | 構文解析 |
| proc-macro2 | 1.0 | procマクロサポート |
| quote | 1.0 | コード生成 |
| thiserror | 2.0 | エラー処理derive |
| anyhow | 1.0 | エラーハンドリング |
| trybuild | 1.0.81 | コンパイルテスト |

## 調査結果

### 1. 各ライブラリの最新バージョンと代替候補

#### byteorder
- **現在**: 1.5.0
- **最新**: 1.5.0
- **使用状況**: **未使用！削除可能** ⚠️
- **代替候補**: 
  - 既に標準ライブラリの機能で実装されている
  - 依存関係から完全に削除可能

#### syn, proc-macro2, quote
- **現在**: 最新の安定版を使用中
- **代替候補**: なし（procマクロ開発の事実上の標準）

#### thiserror
- **現在**: 2.0 (最新)
- **代替候補**: 
  - 手動でのError trait実装
  - `derive_more`のError derive

#### anyhow
- **現在**: 1.0.98 (最新)
- **最新**: 1.0.98
- **代替候補**:
  - `eyre` - より現代的なエラーレポーティング
  - `color-eyre` - カラフルなエラー表示
  - `miette` - 診断情報付きエラー

#### trybuild
- **現在**: 1.0.81
- **最新**: 1.0.105
- **更新推奨**: ✅ マイナーバージョンアップ可能
- **代替候補**: なし（コンパイルテストの標準）

### 2. 現代化のポイント

#### A. Rust Edition
- [ ] implプロジェクトをEdition 2021に更新
- [ ] Rust 2021の新機能活用:
  - `const fn`の拡張
  - パターンマッチングの改善
  - Disjoint capture in closures
  - IntoIterator for arrays

#### B. エラーハンドリング
- [ ] `Result<T, Box<dyn Error>>`パターンの見直し
- [ ] カスタムエラー型の実装
- [ ] より詳細なエラーコンテキストの提供

#### C. パフォーマンス最適化
- [ ] `const fn`の活用
- [ ] ゼロコピーデシリアライゼーションの検討
- [ ] SIMD最適化の可能性

#### D. API設計
- [ ] Builder patternの導入検討
- [ ] より直感的なAPI設計
- [ ] ドキュメント・サンプルの充実

#### E. テスト・CI/CD
- [ ] Property-based testingの導入
- [ ] ベンチマークスイートの追加
- [ ] GitHub Actionsの最適化:
  - 複数Rustバージョンでのテスト (MSRV設定)
  - cargo clippyの追加
  - cargo fmtのチェック
  - キャッシュの活用
  - セキュリティ監査 (cargo audit)

## 作業計画

### フェーズ1: 基本的な更新 (優先度: 高)
1. implプロジェクトのEdition更新
2. 依存関係の最新バージョンへの更新
3. 非推奨機能の置き換え

### フェーズ2: 現代的な機能の活用 (優先度: 中)
1. Rust 2021/2024の新機能の適用
2. エラーハンドリングの改善
3. パフォーマンス最適化

### フェーズ3: エコシステムの強化 (優先度: 低)
1. ドキュメントの充実
2. ベンチマークの追加
3. CI/CDパイプラインの改善

## 発見事項

### 未使用の依存関係
- **byteorder**: プロジェクト全体で一切使用されていない → 削除可能

### コンパイル時の警告
- `impl/src/ast.rs:18`: フィールド`original`が未使用

### CI/CDの改善点
- 現在はUbuntu + stable Rustでのテストのみ
- linter、formatter、セキュリティ監査が未設定
- 複数プラットフォーム・Rustバージョンでのテストが未実施

## 実施済みタスク
- [x] プロジェクトの依存関係調査
- [x] 各ライブラリの最新バージョン確認
- [x] Rust 2021/2024エディションの新機能調査

### フェーズ1完了 (2025/6/10)
- [x] byteorderライブラリの削除
- [x] implプロジェクトのEdition 2021への更新
- [x] trybuildを1.0.105へ更新
- [x] コンパイル警告の修正（未使用フィールドに`_`プレフィックス追加）
- [x] 全テストの動作確認

## 次のステップ（フェーズ2）
1. Rust 2021の新機能活用
2. エラーハンドリングの改善検討
3. CI/CDパイプラインの強化
   - cargo clippyの追加
   - cargo fmtのチェック
   - 複数Rustバージョンでのテスト
   - セキュリティ監査の追加